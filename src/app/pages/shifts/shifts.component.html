<div class="card">
  <div class="page-title">Shifts</div>
  <div class="header-row">
    <div class="controls shift-header-controls">
      <select class="input small-select" [(ngModel)]="selectedTeamId" (change)="load(+selectedTeamId)">
        @for (team of teams; track $index) {
        <option [value]="team.id">{{ team.name }}</option>
        }
      </select>
      <button class="btn primary pill" (click)="load(+selectedTeamId)">Refresh</button>
    </div>
  </div>

  <div class="create-shift-container">
    <input class="input" placeholder="Name" [(ngModel)]="newShift.name" />
    <input class="input" placeholder="Code (1 char)" maxlength="1" [(ngModel)]="newShift.initialCode" />
    <input class="input" placeholder="Start (HH:MM)" [(ngModel)]="newShift.startTime" />
    <input class="input" placeholder="End (HH:MM)" [(ngModel)]="newShift.endTime" />
    <input class="input" type="number" min="1" placeholder="Required people" [(ngModel)]="newShift.requiredPeople"
      style="width:160px" />
    <button class="btn primary pill" (click)="create()">Create</button>
  </div>
  <div style="margin-top:0.75rem">
    <div class="table-scroll">
      <table class="shifts-table mat-elevation-z3">
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Start</th>
            <th>End</th>
            <th>Required people</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @for (shift of shifts; track $index) {
          <tr>
            <ng-container *ngIf="editingId !== shift.id; else editRow">
              <td class="code-cell">{{ shift.initialCode || '-' }}</td>
              <td>{{ shift.name }}</td>
              <td>{{ shift.startTime }}</td>
              <td>{{ shift.endTime }}</td>
              <td class="muted">{{ shift.requiredPeople || 1 }}</td>
              <td class="actions">
                <button class="btn pill" (click)="startEdit(shift)">Edit</button>
                <button class="btn pill danger" (click)="deleteShift(shift)">Delete</button>
              </td>
            </ng-container>
            <ng-template #editRow>
              <td class="code-cell">
                <input class="input" maxlength="1" [(ngModel)]="editModel.initialCode" />
              </td>
              <td>
                <input class="input" [(ngModel)]="editModel.name" />
              </td>
              <td>
                <input class="input" [(ngModel)]="editModel.startTime" />
              </td>
              <td>
                <input class="input" [(ngModel)]="editModel.endTime" />
              </td>
              <td>
                <input class="input" type="number" min="1" [(ngModel)]="editModel.requiredPeople" />
              </td>
              <td class="actions">
                <button class="btn primary pill" (click)="saveEdit()" [disabled]="!canSaveEdit()">Save</button>
                <button class="btn pill" (click)="cancelEdit()">Cancel</button>
              </td>
            </ng-template>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

@if (loading) {
<div class="muted">Loadingâ€¦</div>
}

<app-confirm [visible]="confirmState.visible" [title]="confirmState.title" [message]="confirmState.message"
  [confirmLabel]="confirmState.confirmLabel ?? null" [cancelLabel]="confirmState.cancelLabel ?? null"
  (confirmed)="onConfirmedDelete()" (cancelled)="onCancelledDelete()">
</app-confirm>