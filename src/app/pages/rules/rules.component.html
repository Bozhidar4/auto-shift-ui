<div class="card">
  <div class="page-title">Rules</div>

  <div class="controls" style="margin-bottom:0.75rem">
    <label style="display:flex;align-items:center;gap:0.5rem">Select Team:</label>
    <select class="input rules-team-select" [(ngModel)]="selectedTeamId" (change)="onTeamChange()">
      <option [ngValue]="null">-- choose team --</option>
      <option *ngFor="let t of teams" [ngValue]="t.id">{{ t.name || ('Team ' + t.id) }}</option>
    </select>
  </div>

  <div *ngIf="!selectedTeamId" class="muted">Please select a team to view and edit its rule values.</div>

  <div *ngIf="selectedTeamId">
    <div *ngIf="rules.length === 0">No rules available.</div>
    <ul class="rules-list">
      <li *ngFor="let r of rules">
        <div class="rule-row">
          <div class="rule-info">
            <strong>{{ r.name || r.key || r.type }}</strong>
            <div class="desc muted">{{ r.description }}</div>
          </div>
          <div class="rule-action" *ngIf="r.requiresInput">
            <input class="input" *ngIf="r.inputType === 'int' || r.inputType === null" type="number" min="1" [value]="getValueForRule(r)"
              (input)="setValueForRule(r, $any($event.target).valueAsNumber)" [disabled]="!selectedTeamId" />
            <div *ngIf="(r.inputType === 'int' || r.inputType === null) && isInvalidIntValue(r)" class="muted" style="font-size:0.85rem;margin-top:0.25rem;color:var(--danger,#d9534f)">Value must be at least 1</div>
            <input class="input" *ngIf="r.inputType === 'string'" type="text" [value]="getValueForRule(r)"
              (input)="setValueForRule(r, $any($event.target).value)" [disabled]="!selectedTeamId" />
            <button class="btn primary pill" (click)="saveRuleValue(r)" [disabled]="!selectedTeamId || savingMap[r.id]">
              <span *ngIf="!savingMap[r.id]">Save</span>
              <span *ngIf="savingMap[r.id]">Saving...</span>
            </button>
          </div>
          <div class="rule-action" *ngIf="!r.requiresInput">
            <span class="muted">Fixed rule</span>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
